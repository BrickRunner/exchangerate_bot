# Changelog

–í—Å–µ –≤–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.

## [1.1.0] - 2024

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- **[SECURITY]** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è –≤ `database.py:update_settings()`
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π —á–µ—Ä–µ–∑ whitelist `ALLOWED_SETTINGS_FIELDS`
  - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤
- **[SECURITY]** –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - –°–æ–∑–¥–∞–Ω `.env.example` –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
  - –û–±–Ω–æ–≤–ª–µ–Ω `.gitignore` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —É—Ç–µ—á–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤
- **[SECURITY]** –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤–≤–æ–¥–æ–≤
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (200 —Å–∏–º–≤–æ–ª–æ–≤)
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ (500 —Å–∏–º–≤–æ–ª–æ–≤)
  - –í–∞–ª–∏–¥–∞—Ü–∏—è —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏

### ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ UTC**
  - –ò–∑–º–µ–Ω–µ–Ω–∞ –Ω–æ—Ç–∞—Ü–∏—è —Å GMT –Ω–∞ UTC
  - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é UTC+3 (–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è) –≤–º–µ—Å—Ç–æ UTC+0
  - –£–ª—É—á—à–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- **–ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - –õ–æ–≥–∏ –≤ —Ñ–∞–π–ª `bot.log` –∏ –∫–æ–Ω—Å–æ–ª—å
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å stack traces
- **Graceful shutdown**
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
  - –ó–∞–∫—Ä—ã—Ç–∏–µ HTTP-—Å–µ—Å—Å–∏–π –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ SIGINT/SIGTERM
- **–°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏**
  - `migrate_timezone.py` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ë–î

### üîß –£–ª—É—á—à–µ–Ω–∏—è

- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π API
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ XML
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ —Å retry-–ª–æ–≥–∏–∫–æ–π
  - –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –≥–æ–ª—ã—Ö `except:`

- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
  - Connection pooling –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∞–ª—é—Ç (TTL: 1 —á–∞—Å)
  - –ò–Ω–¥–µ–∫—Å—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ `user_id` –∏ `currency`
  - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**
  - Type hints –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
  - –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–º–µ—Å—Ç–æ magic numbers
  - –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ docstrings

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- **Scheduler**
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ `sent_this_minute` –∫–µ—à
  - –£–≤–µ–ª–∏—á–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å 30 –¥–æ 60 —Å–µ–∫—É–Ω–¥
  - –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞

- **API**
  - –î–æ–±–∞–≤–ª–µ–Ω—ã timeout –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (20-30 —Å–µ–∫—É–Ω–¥)
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö XML-–æ—Ç–≤–µ—Ç–æ–≤
  - User-Agent –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTP-—Å–µ—Å—Å–∏–∏

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
  - –î–æ–±–∞–≤–ª–µ–Ω—ã foreign key constraints
  - –î–æ–±–∞–≤–ª–µ–Ω—ã NOT NULL constraints
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - –ò–∑–º–µ–Ω–µ–Ω default timezone —Å '0' –Ω–∞ '3'

- **–í–∞–ª–∏–¥–∞—Ü–∏—è**
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤ (-12 –¥–æ +14)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ (00:00 - 23:59)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
  - –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤–∞–ª—é—Ç (trim, uppercase, limit length)

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –°–æ–∑–¥–∞–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π [README.md](README.md)
- –°–æ–∑–¥–∞–Ω [SECURITY.md](SECURITY.md) —Å –ª—É—á—à–∏–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏
- –°–æ–∑–¥–∞–Ω [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md) –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –£–ª—É—á—à–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è API

#### database.py
```python
# –ë—ã–ª–æ
async def update_settings(user_id: int, field: str, value: str):
    await db.execute(f"UPDATE user_settings SET {field}=? ...")  # SQL-–∏–Ω—ä–µ–∫—Ü–∏—è!

# –°—Ç–∞–ª–æ
async def update_settings(user_id: int, field: str, value: str):
    if field not in ALLOWED_SETTINGS_FIELDS:
        raise ValueError(f"Invalid field: {field}")
    # ... –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```

#### config.py
```python
# –ù–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
DEFAULT_TIMEZONE = 3  # UTC+3 (–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è)
DEFAULT_CURRENCIES = "USD,EUR"
DEFAULT_WORKDAYS = [1, 2, 3, 4, 5]
DEFAULT_NOTIFY_TIME = "08:00"
```

#### keyboards.py
```python
# –ë—ã–ª–æ: GMT+3, GMT-5
# –°—Ç–∞–ª–æ: UTC+3, UTC-5
def build_timezone_kb() -> InlineKeyboardMarkup:
    text = f"UTC{tz:+d}"  # –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
```

### üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ

- –£–¥–∞–ª–µ–Ω—ã hardcoded –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã)
- –£–¥–∞–ª–µ–Ω—ã silent exception handlers
- –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã

### ‚ö†Ô∏è Breaking Changes

- **Default timezone –∏–∑–º–µ–Ω–µ–Ω —Å 0 –Ω–∞ 3**
  - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç UTC+3 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `migrate_timezone.py`

- **–¢–æ–∫–µ–Ω —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ .env**
  - –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–µ–∑ `BOT_TOKEN` –≤ `.env`
  - –°–º. `.env.example` –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

- –§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ: 12
- –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ~800
- –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ —É–¥–∞–ª–µ–Ω–æ: ~150
- –ü—Ä–æ–±–ª–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 42
  - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö: 2
  - –í—ã—Å–æ–∫–∏—Ö: 7
  - –°—Ä–µ–¥–Ω–∏—Ö: 25
  - –ù–∏–∑–∫–∏—Ö: 8

---

## [1.0.0] - Initial Release

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–æ—Ç–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- ‚ùå SQL-–∏–Ω—ä–µ–∫—Ü–∏—è –≤ update_settings
- ‚ùå –¢–æ–∫–µ–Ω –≤ –∫–æ–¥–µ
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
