# Безопасность проекта

## Если вы обнаружили токен бота в Git-истории

### ⚠️ КРИТИЧЕСКИ ВАЖНО

Если токен бота был случайно закоммичен в Git:

1. **Немедленно отзовите токен:**
   - Откройте [@BotFather](https://t.me/BotFather) в Telegram
   - Отправьте команду `/mybots`
   - Выберите ваш бот
   - Нажмите "API Token"
   - Выберите "Revoke current token"
   - Получите новый токен

2. **Очистите Git-историю:**
   ```bash
   # ВНИМАНИЕ: Это перепишет историю!
   git filter-branch --force --index-filter \
   "git rm --cached --ignore-unmatch .env" \
   --prune-empty --tag-name-filter cat -- --all

   # Force push (если репозиторий публичный)
   git push origin --force --all
   ```

3. **Обновите `.env` с новым токеном**

## Лучшие практики

### Переменные окружения

- ✅ Всегда используйте `.env` для секретов
- ✅ Добавьте `.env` в `.gitignore`
- ✅ Используйте `.env.example` для документации
- ❌ Никогда не храните секреты в коде
- ❌ Никогда не коммитьте `.env`

### База данных

- ✅ Все запросы используют параметризацию
- ✅ Валидация через whitelist для динамических полей
- ✅ Ограничение длины пользовательского ввода
- ✅ Foreign key constraints для целостности
- ✅ Индексы для производительности

### API запросы

- ✅ Все запросы имеют timeout
- ✅ Обработка всех типов ошибок
- ✅ User-Agent для идентификации
- ✅ Connection pooling
- ✅ Валидация XML/JSON ответов

### Пользовательский ввод

- ✅ Валидация формата (email, время и т.д.)
- ✅ Санитизация перед сохранением
- ✅ Ограничение длины строк
- ✅ Проверка диапазонов числовых значений

## Известные ограничения

1. **Часовые пояса**: Используются простые hour offsets, не поддерживается DST
2. **Rate limiting**: Нет ограничения частоты запросов от пользователей
3. **Аутентификация**: Опирается только на Telegram ID

## Отчёт об уязвимостях

Если вы обнаружили уязвимость в коде:

1. **НЕ создавайте публичный Issue**
2. Свяжитесь с разработчиком напрямую
3. Опишите проблему и шаги воспроизведения
4. Дайте время на исправление перед публикацией

## Changelog исправлений безопасности

### v1.1 (текущая версия)

- ✅ Исправлена критическая SQL-инъекция в `update_settings()`
- ✅ Добавлена валидация всех пользовательских вводов
- ✅ Токен вынесен в переменные окружения
- ✅ Добавлено логирование всех операций
- ✅ Улучшена обработка ошибок API
- ✅ Добавлена защита от XML parsing errors
- ✅ Реализован graceful shutdown

### v1.0 (начальная версия)

- ❌ Токен в коде
- ❌ SQL-инъекция
- ❌ Нет валидации ввода
- ❌ Нет обработки ошибок
